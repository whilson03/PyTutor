<html>
<head>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <script src="www/jquery-3.5.1.min.js" type="text/javascript"></script>
    <script src="www/skulpt.min.js" type="text/javascript"></script>
    <script src="www/skulpt-stdlib.js" type="text/javascript"></script>

</head>
<body>

<script type="text/javascript">

        function outf(text) {
            var mypre = document.getElementById("output");
            mypre.innerHTML = mypre.innerHTML + text;
        }
        function builtinRead(x) {
            if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
                    throw "File not found: '" + x + "'";
            return Sk.builtinFiles["files"][x];
        }



        Sk.configure({
          output: outf,
          // yieldLimit: 100,
          // execLimit: 5000,
          killableWhile: true,
          killableFor: true,

          inputTakesPrompt: true,
          // you can customise the input function - this can return a promise - the default is just to use window.prompt
          inputfun: function (args) {
            return new Promise((resolve, reject) => {
              setTimeout(function() {
                resolve(window.prompt(args))
              }, 250)
            })
          },
          read: builtinRead,
          __future__: Sk.python3
        });


        function run("print("code")") {
          StopExecution = false;
          const prog = code;
          const output = document.getElementById("output");
          const status = document.getElementById("status");
          output.innerHTML = "";
          status.innerHTML = "Running" ;

          Sk.misceval.asyncToPromise(() =>
            Sk.importMainWithBody("<stdin>", false, prog, true), {
              // handle a suspension of the executing code
              // "*" says handle all types of suspensions
              "*": () => {
                if (StopExecution) throw "Execution interrupted"
              }
            },
          ).catch(err => {
            outf("\n" + err.toString());
          }).finally(() => {
            status.innerHTML = "Stopped" ;
          })
        }



        function stopit() {
          StopExecution = true;
        }



</script>

<pre id="output"></pre>
</body>
</html>